<!doctype html>
<html lang="hr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Za tebe ‚ù§Ô∏è</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@600;700&family=Cormorant+Garamond:wght@500;600&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@500;600&display=swap" rel="stylesheet">



  <style>:root{
      --paper:#f6e9df;
      --ink:#2b2b2b;
      --accent:#b3123b;
      --muted:#6a5b55;
      --line:#3a2f2a;
      --radius:26px;
    }
    html, body { height:100%; }
    body{
      margin:0;
      display:grid;
      place-items:center;
      background: radial-gradient(1200px 600px at 50% 0%, #ffd7e6 0%, #13010a 55%, #050007 100%);
      font-family: "Nunito", system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
      color:var(--ink);
      overflow:hidden;
    }

    .bg{
      position:fixed; inset:0;
      background:
        radial-gradient(circle at 20% 30%, rgba(255,105,180,.25), transparent 55%),
        radial-gradient(circle at 75% 25%, rgba(255,0,80,.18), transparent 60%),
        radial-gradient(circle at 55% 80%, rgba(255,105,180,.10), transparent 55%);
      pointer-events:none;
      opacity:.85;
    }
	

    .card{
      width:min(980px, 92vw);
      height:min(540px, 76vh);
      background:var(--paper);
      border-radius:var(--radius);
      box-shadow: 0 30px 80px rgba(0,0,0,.45);
      position:relative;
      overflow:hidden;
    }

    .content{
      position:absolute; inset:0;
      display:grid;
      grid-template-columns: 1.05fr 1.25fr;
      gap:18px;
      padding:34px 34px 22px;
    }

    .left h1{
      margin:0 0 12px 0;
      font-size:40px;
      color:var(--accent);
      font-family: "Dancing Script", cursive;
    }

    .left .poem{
  font-family: "Cormorant Garamond", serif;
  font-size:20px;
  line-height:1.8;
  letter-spacing:.3px;
  max-width:380px;
}

    .right{
      position:relative;
      min-height:0;
      height:100%;
    }

    /* This is the key: guarantee the canvas has height */
    #wrapCanvas{
      height:100%;
      min-height:320px;
      border-radius:18px;
      overflow:hidden;
      position:relative;
    }

    canvas{
      display:block;
      width:100%;
      height:100%;
      background: transparent;
    }

    .hint{
      position:absolute;
      top:12px; right:12px;
      font-size:12px;
      color:rgba(0,0,0,.45);
      user-select:none;
      z-index:2;
    }

    .divider{
      position:absolute;
      left:0; right:0;
      bottom:46px;
      height:2px;
      background: linear-gradient(to right, transparent 0%, rgba(58,47,42,.55) 12%, rgba(58,47,42,.55) 88%, transparent 100%);
      opacity:.75;
    }

    .timer{
  position:absolute;
  bottom:8px;
  left:0;
  width:100%;
  display:flex;
  justify-content:center;   /* center everything */
  align-items:baseline;
  gap:14px;                 /* space between text and numbers */
}
.timer div:first-child{
  font-family: "Dancing Script", cursive;
  font-size:30px;     /* bigger */
  color:var(--accent);
}

   .timer b{
  font-family: "Cinzel", serif;
  font-size:22px;
  letter-spacing:1px;
  color:var(--accent);
}

/* Intro overlay (first screen) */
.intro{
  position:absolute;
  inset:0;
  display:grid;
  place-items:center;
  pointer-events:auto;
  z-index:3; /* above canvas/glow */
}

.introTitle{
  font-family:"Playfair Display", serif;
  color:var(--accent);
  font-size:40px;
  text-align:center;
  transform: translateY(-34px);
  transition: opacity .45s ease, transform .45s ease;
}

.introHint{
  font-family:"Dancing Script", cursive;
  color:rgba(0,0,0,.45);
  font-size:20px;
  margin-top:12px;
  transition: opacity .45s ease, transform .45s ease;
}

.introHeart{
  border:none;
  background:transparent;
  cursor:pointer;
  font-size:78px;
  line-height:1;
  color:#c0133a;
  filter: drop-shadow(0 12px 18px rgba(0,0,0,.22));
  position:absolute;
  left:50%;
  top:50%;
  transform: translate(-50%,-50%);
  transition: transform .9s cubic-bezier(.2,.9,.25,1), opacity .45s ease;
  user-select:none;
}

.introHeart:hover{ transform: translate(-50%,-50%) scale(1.06); }

.intro.go .introTitle,
.intro.go .introHint{
  opacity:0;
  transform: translateY(-52px);
}

.intro.go .introHeart{
  transform: translate(-50%,-50%) translateY(var(--dropY)) scale(0.82);
}

.intro.plant{
  pointer-events:none; /* let clicks go to canvas after planting */
}
.intro.plant .introTitle,
.intro.plant .introHint{
  opacity:0;
}
.intro.plant .introHeart{
  /* stays at planted position; JS will tweak opacity/scale for the morph */
  transform: translate(-50%,-50%) translateY(var(--dropY)) scale(0.82);
}

.intro.done{
  pointer-events:none;
}

    @media (max-width: 860px){
  /* Make everything a bit smaller and reserve space for the footer counter */
  .card{
    height: min(780px, 92vh);
  }

  .content{
    grid-template-columns: 1fr;
    padding: 18px 18px 110px; /* bottom space so text never overlaps timer */
    gap: 14px;
  }

  .left h1{
    font-size: 32px;
    text-align: center;
    margin-bottom: 10px;
  }

  .left .poem{
    font-size: 17px;
    line-height: 1.55;
    max-width: none;
  }

  /* Give the canvas a bit more room while keeping the text readable */
  .right{
    height: 50%;
  }

  #wrapCanvas{
    min-height: 320px;
  }

  .divider{
    bottom: 88px; /* above timer */
  }

  .timer{
    left: 18px;
    right: 18px;
    bottom: 10px;
    gap: 10px;
    flex-direction: column;
    align-items: center;
    text-align: center;
  }

  .timer div:first-child{
    font-size: 22px;
    line-height: 1.1;
  }

  .timer b{
    font-size: 16px;
    letter-spacing: 0.8px;
    white-space: normal;
  }

  .introTitle{ font-size: 34px; }
  .introHeart{ font-size: 70px; }
  .introHint{ font-size: 18px; }
} /* <-- IMPORTANT: close the media query */

/* Hearts overlay (NOT inside media) */
#floatLayer{
  position:absolute;
  inset:0;
  pointer-events:none;
  overflow:hidden;
  z-index:4;
}

/* Ensure content is above hearts (NOT inside media) */
.content{ position:absolute; inset:0; z-index:3; }

/* Flying hearts */
.fheart{
  position:absolute;
  font-size:16px;
  opacity:0;
  will-change: transform, opacity;
  animation: flyHeart linear forwards;
  filter: drop-shadow(0 6px 10px rgba(0,0,0,.15));
}

@keyframes flyHeart{
  0%   { transform: translate3d(0,0,0) rotate(0deg) scale(0.9); opacity:0; }
  10%  { opacity:0.85; }
  100% { transform: translate3d(var(--dx), var(--dy), 0) rotate(260deg) scale(1.15); opacity:0; }
}

/* Soft glow pulse behind the heart canopy */
.canopyGlow{
  position:absolute;
  inset:0;
  pointer-events:none;
  z-index:0; /* behind canvas */
  background:
    radial-gradient(circle at 60% 38%,
      rgba(255, 77, 125, 0.38) 0%,
      rgba(255, 77, 125, 0.18) 24%,
      rgba(255, 77, 125, 0.08) 44%,
      rgba(255, 77, 125, 0.00) 65%);
  filter: blur(6px);
  opacity:0.65;
  transform: scale(0.98);
  animation: glowBreath 4.8s ease-in-out infinite;
}

/* Canvas above glow */
#wrapCanvas{ position:relative; }
#wrapCanvas canvas{ position:relative; z-index:1; }
#wrapCanvas .hint{ position:absolute; z-index:2; }

@keyframes glowBreath{
  0%, 100% { opacity:0.45; transform: scale(0.96); }
  50%      { opacity:0.85; transform: scale(1.03); }
}

/* --- Mobile safety: never let text/canvas overlap the footer counter --- */
@media (max-width: 860px){
  .card{
    height: min(860px, 92vh);
  }

  .content{
    position:absolute;
    inset:0;
    display:flex;
    flex-direction:column;
    gap:14px;
    padding:18px 18px 150px; /* reserve footer space */
    overflow:auto;           /* scroll if needed, never overlap footer */
  }

  .left{ flex: 0 0 auto; }
  .right{ flex: 1 1 auto; min-height: 320px; }

  #wrapCanvas{
    height: 100%;
    min-height: 320px;
  }

  .divider{
    position:absolute;
    left:18px; right:18px;
    bottom:118px;
  }

  .timer{
    position:absolute;
    left:18px; right:18px;
    bottom:12px;
    flex-direction: column;
    align-items: center;
    text-align:center;
    gap:6px;
  }

  .timer div:first-child{ font-size:22px; line-height:1.1; }
  .timer b{
    font-size:15px;
    letter-spacing:.6px;
    white-space: normal;
  }
}

/* iPhone landscape / short-height screens */
@media (max-height: 520px){
  .content{ padding-bottom: 170px; }
  .timer div:first-child{ font-size:20px; }
  .timer b{ font-size:14px; }
  .divider{ bottom:126px; }
}

/* --- Mobile tweaks: smaller text, left-aligned counter --- */
@media (max-width: 860px){
  .left h1{
    font-size: 28px;
    line-height: 1.08;
  }

  .left .poem{
    font-size: 15px;
    line-height: 1.45;
  }

  /* Make hint a bit smaller too */
  #wrapCanvas .hint{
    font-size: 12px;
  }

  /* Left-align the counter only on mobile */
  .timer{
    align-items: flex-start;
    text-align: left;
  }

  /* Keep the first line ("Na≈°a ljubav...") left too */
  .timer div:first-child{
    width: 100%;
    text-align: left;
    font-size: 20px;
  }

  /* And the numbers line */
  .timer b{
    width: 100%;
    text-align: left;
    font-size: 14px;
  }
}
</style>
</head>

<body>
  <div class="bg"></div>
  

  <div class="card">
<noscript>
  <div style="padding:14px 16px;margin:14px 18px;border-radius:14px;background:#fff3f6;color:#7b1b33;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;font-size:14px;line-height:1.35;">
    Ova stranica treba JavaScript. Ako otvara≈° datoteku u iPhone pregledaƒçu (Files/Preview) ili unutar neke aplikacije, animacije i brojaƒç neƒáe raditi.
    Otvori link u <b>Safari</b> (pravi Safari) ili hostaj datoteku (GitHub Pages / Cloudflare Pages).
  </div>
</noscript>

  <div id="floatLayer" aria-hidden="true"></div>
    <div class="content">
      <div class="left">
        <h1>Za moju ljubav ‚ù§Ô∏è</h1>
        <div class="poem">
Ivona moja najdra≈æa.. Hvala ti za sve ≈°to ƒçini≈° za mene, za svoju bri≈ænost, za svoju dobrotu, za svoju ljubav prema meni i ≈°to si tu uz mene, uvijek. 
Hvala na svim lijepim upuƒáenim rijeƒçima, djelima, znakovima pa≈ænje. 
Volim te, mi≈° moj najdra≈æi!üê≠
 Mali znak pa≈ænje, kojeg uvijek mo≈æe≈° otvoriti, pogledati i popratiti koliko dugo smo jedno uz drugo veƒá.‚ù£Ô∏è
        </div>
      </div>

      <div class="right">
        <div id="wrapCanvas">
		 <div class="canopyGlow"></div>
          <div id="intro" class="intro">
            <div class="introTitle">Za Ivonu</div>
            <button id="introHeart" class="introHeart" aria-label="Pokreni">‚ù§</button>
            <div class="introHint">Klikni srce</div>
          </div>
          <div class="hint">klikni drvo za restart üå∏</div>
          <canvas id="c"></canvas>
        </div>
      </div>

      <div class="divider"></div>

      <div class="timer">
        <div>Na≈°a ljubav traje veƒá‚Ä¶</div>
        <!-- default text so you can SEE it even if JS fails -->
        <div><b id="since">uƒçitavanje‚Ä¶</b></div>
      </div>
    </div>
  </div>

  <script>
  document.addEventListener("DOMContentLoaded", () => {
    try {
      /**********************
       * TIMER (Croatian)
       **********************/
      const startDate = new Date(2025, 9, 11, 2, 0, 0); // 11.10.2025 (month 10 = Nov)

      const sinceEl = document.getElementById("since");
      const pad = (n) => String(n).padStart(2,"0");

      function tick(){
        const now = new Date();
        let total = Math.floor((now - startDate)/1000);
        if (!Number.isFinite(total)) total = 0;

        const days = Math.floor(total/86400);
        const hours = Math.floor((total%86400)/3600);
        const mins = Math.floor((total%3600)/60);
        const secs = total%60;

        sinceEl.textContent = `${days} dana ${pad(hours)} sati ${pad(mins)} minuta ${pad(secs)} sekundi`;
      }
      tick();
      setInterval(tick, 250);

      /**********************
       * CANVAS: tree + bloom
       **********************/
      const canvas = document.getElementById("c");
      const ctx = canvas.getContext("2d");

      function resize(){
        const rect = canvas.getBoundingClientRect();
        const dpr = Math.max(1, Math.min(2, window.devicePixelRatio || 1));

        // If rect is 0 (some browsers), give a fallback size:
        const cssW = Math.max(300, rect.width  || 0);
        const cssH = Math.max(300, rect.height || 0);

        canvas.width  = Math.floor(cssW * dpr);
        canvas.height = Math.floor(cssH * dpr);
        ctx.setTransform(dpr,0,0,dpr,0,0);
      }
      window.addEventListener("resize", resize);

      function heartPoint(t) {
        return {
          x: 16 * Math.pow(Math.sin(t), 3),
          y: 13 * Math.cos(t) - 5 * Math.cos(2*t) - 2 * Math.cos(3*t) - Math.cos(4*t)
        };
      }

      function drawMiniHeart(x,y,size,rot,alpha){
        ctx.save();
        ctx.translate(x,y);
        ctx.rotate(rot);
        ctx.scale(size,size);
        ctx.globalAlpha = alpha;

        ctx.beginPath();
        ctx.moveTo(0, -0.35);
        ctx.bezierCurveTo(0.5,-0.95, 1.4,-0.1, 0, 1.15);
        ctx.bezierCurveTo(-1.4,-0.1, -0.5,-0.95, 0,-0.35);
        ctx.closePath();

        ctx.fillStyle = "#c0133a";
        ctx.fill();

        ctx.globalAlpha = alpha*0.45;
        ctx.fillStyle = "#ff4d7d";
        ctx.fill();
        ctx.restore();
      }
	  function drawTipHearts(branch){
  if (branch.children.length === 0) {
    const tip = branch.endPoint();
    drawMiniHeart(tip.x, tip.y, 2.5, 0, 0.85);
  } else {
    for (const ch of branch.children) drawTipHearts(ch);
  }
}

      class Branch{
        constructor(x,y,angle,len,thick,depth){
          this.x=x; this.y=y;
          this.angle=angle;
          this.len=len;
          this.thick=thick;
          this.depth=depth;
          this.progress=0;
          this.done=false;
          this.children=[];
        }
        step(){
          this.progress = Math.min(1, this.progress + 0.015 + (0.002*this.depth));
          if(this.progress>=1 && !this.done){
            this.done=true;
            if(this.depth < 8){
  const n = (this.depth < 3) ? 2 : ((Math.random() < 0.35) ? 1 : 2);
  for(let i=0;i<n;i++){
    const a = this.angle + (i===0? -1 : 1) * (0.35 + Math.random()*0.35);
    const l = this.len * (0.65 + Math.random()*0.10);
    const t = this.thick * 0.72;
    const end = this.endPoint();
    this.children.push(new Branch(end.x, end.y, a, l, t, this.depth+1));
  }
}
          }
          for(const ch of this.children) ch.step();
        }
        endPoint(){
          const px = this.x + Math.cos(this.angle) * this.len * this.progress;
          const py = this.y - Math.sin(this.angle) * this.len * this.progress;
          return {x:px, y:py};
        }
        draw(){
          const end = this.endPoint();
          ctx.lineCap="round";
          ctx.lineWidth = this.thick;
          ctx.strokeStyle = "#6b3d2b";
          ctx.beginPath();
          ctx.moveTo(this.x, this.y);
          ctx.lineTo(end.x, end.y);
          ctx.stroke();
          for(const ch of this.children) ch.draw();
        }
        allDone(){
          if(!this.done) return false;
          return this.children.every(ch => ch.allDone());
        }
      }

      const petals = [];
      function spawnPetals(centerX, centerY, scale){
        petals.length = 0;
        const count = 9800; // denser
        for(let i=0;i<count;i++){
          const t = Math.random()*Math.PI*2;
          const p = heartPoint(t);

          // ORIGINAL (what you requested)
          const r = 0.55 + Math.random()*0.6;
          const x = centerX + p.x * scale * r + (Math.random()*10-5);
          const y = centerY - p.y * scale * r + (Math.random()*10-5);

          petals.push({
            x,y,
            s: 0.6 + Math.random()*1.2,
            rot: Math.random()*Math.PI,
            a: 0.25 + Math.random()*0.7,
            vy: 0.05 + Math.random()*0.35,
            wob: Math.random()*Math.PI*2
          });
        }
      }

      let root;
      let stage = 0;
      let bloomProgress = 0;
      let started = false;
      let flyTimer = null;
      let lastBaseX = 0;
      let lastBaseY = 0;
      let seedGlow = 0; // 1 -> visible, fades to 0
      let plantActive = false;
      let introDropY = 0;
      let plantStart = 0;
let grassBlades = [];
let tGrass = 0;

      function drawGround(w,h){
        ctx.globalAlpha = 0.8;
        ctx.lineWidth = 2;
        ctx.strokeStyle = "#3a2f2a";
        ctx.beginPath();
        ctx.moveTo(w*0.08, h*0.86);
        ctx.lineTo(w*0.92, h*0.86);
        ctx.stroke();
        ctx.globalAlpha = 1;
      }
	  function makeGrass(w, h){
  const baseY = h * 0.86;
  grassBlades = [];
  const count = Math.floor(w / 6); // density

  for(let i=0;i<count;i++){
    const x = i * 6 + (Math.random()*4 - 2);
    const height = 8 + Math.random()*16;
    const bend = (Math.random()-0.5) * 10;
    const alpha = 0.35 + Math.random()*0.35;
    const thick = 1 + Math.random()*0.8;

    grassBlades.push({ x, baseY, height, bend, alpha, thick });
  }
}

function drawGrass(){
  tGrass += 0.02; // sway speed

  for(const g of grassBlades){
    const sway = Math.sin(tGrass + g.x * 0.03) * 2.2; // gentle motion
    ctx.lineWidth = g.thick;
    ctx.strokeStyle = `rgba(20, 110, 30, ${g.alpha})`;

    ctx.beginPath();
    ctx.moveTo(g.x, g.baseY);
    ctx.quadraticCurveTo(
      g.x + g.bend*0.5 + sway,
      g.baseY - g.height*0.6,
      g.x + g.bend + sway,
      g.baseY - g.height
    );
    ctx.stroke();
  }
}

      function reset(){
        resize();
        const w = canvas.getBoundingClientRect().width;
        const h = canvas.getBoundingClientRect().height;

        const baseX = w*0.52;
        const baseY = h*0.86;
        lastBaseX = baseX;
        lastBaseY = baseY;
        makeGrass(w, h);

        root = new Branch(baseX, baseY, Math.PI/2, h*0.26, 10, 0);
        stage = 0;
        bloomProgress = 0;

        spawnPetals(w*0.63 - 50, h*0.40, Math.min(w,h) * (window.matchMedia('(max-width: 860px)').matches ? 0.015 : 0.018));
		seedGlow = 0;
window.__tipsDrawn = false;
      }

      function animate(){
        const rect = canvas.getBoundingClientRect();
        const w = rect.width;
        const h = rect.height;

        ctx.clearRect(0,0,w,h);
drawGround(w,h);
drawGrass();

        // seed glow (brief) at the base, after the intro click
        if (seedGlow > 0.001) {
          const g = ctx.createRadialGradient(lastBaseX, lastBaseY, 0, lastBaseX, lastBaseY, 28);
          g.addColorStop(0, `rgba(255, 77, 125, ${0.55 * seedGlow})`);
          g.addColorStop(0.35, `rgba(255, 77, 125, ${0.18 * seedGlow})`);
          g.addColorStop(1, "rgba(255, 77, 125, 0)");
          ctx.fillStyle = g;
          ctx.beginPath();
          ctx.arc(lastBaseX, lastBaseY, 28, 0, Math.PI * 2);
          ctx.fill();
          seedGlow *= 0.92;
        }

        root.step();

        // Morph + sprout: heart "plants" and a pink sprout starts while the heart slowly sinks/fades
        if (plantActive) {
          const elapsed = performance.now() - plantStart; // ms
          const p = Math.min(1, elapsed / 650); // ~0.65s total morph (faster)

          // Start drawing a small sprout immediately
          const sproutLen = (h * 0.26) * 0.35 * p; // up to ~35% of trunk length
          ctx.save();
          ctx.lineCap = "round";
          ctx.lineWidth = 6;
          ctx.strokeStyle = `rgba(255, 77, 125, ${0.55 * (1 - p*0.25)})`;
          ctx.beginPath();
          ctx.moveTo(lastBaseX, lastBaseY);
          ctx.lineTo(lastBaseX, lastBaseY - sproutLen);
          ctx.stroke();

          // soft sprout glow
          const sg = ctx.createRadialGradient(lastBaseX, lastBaseY - sproutLen, 0, lastBaseX, lastBaseY - sproutLen, 26);
          sg.addColorStop(0, `rgba(255, 77, 125, ${0.40 * (1 - p*0.25)})`);
          sg.addColorStop(0.45, `rgba(255, 77, 125, ${0.14 * (1 - p*0.25)})`);
          sg.addColorStop(1, "rgba(255, 77, 125, 0)");
          ctx.fillStyle = sg;
          ctx.beginPath();
          ctx.arc(lastBaseX, lastBaseY - sproutLen, 26, 0, Math.PI*2);
          ctx.fill();
          ctx.restore();

          // Delay the heart fade so you SEE overlap with the sprout/trunk
          const fadeStart = 0.10; // first ~10%: brief hold before fading
          const q = (p <= fadeStart) ? 0 : (p - fadeStart) / (1 - fadeStart); // 0..1
          const opacity = 1 - q;
          const scale = 0.82 - 0.62*q;

          introHeart.style.opacity = String(opacity);
          introHeart.style.transform = `translate(-50%,-50%) translateY(${introDropY}px) scale(${scale})`;
          if (opacity < 0.08) introHeart.style.display = "none";

          if (p >= 1) {
            intro.classList.add("done");
            intro.style.display = "none";
            plantActive = false;
          }
        }
        root.draw();

        if(stage===0 && root.allDone()) stage = 1;
		

        if(stage===1){
          bloomProgress = Math.min(1, bloomProgress + 0.008);
		  drawTipHearts(root);
          const toDraw = Math.floor(petals.length * bloomProgress);

          for(let i=0;i<toDraw;i++){
            const p = petals[i];
            p.wob += 0.02;
            const dx = Math.sin(p.wob)*0.25;
            p.y += p.vy*0.12;
            drawMiniHeart(p.x+dx, p.y, p.s*0.9, p.rot, p.a);
          }
        }
		

        requestAnimationFrame(animate);
      }

      canvas.addEventListener("click", () => {
        if (!started) return;
        reset();
      });

      // --- Flying hearts: start only after intro ---
      const layer = document.getElementById("floatLayer");
      function spawnFlyingHeart(){
        const el = document.createElement("div");
        el.className = "fheart";
        el.textContent = "‚ù§";

        const rect = layer.getBoundingClientRect();
        el.style.setProperty("--dx", `${-(rect.width + 140)}px`);
        el.style.setProperty("--dy", `${(rect.height + 140)}px`);

        const startX = rect.width + 20 + Math.random() * 60;
        const startY = -20 + Math.random() * (rect.height * 0.35);

        const size = 10 + Math.random() * 16;
        const duration = 6 + Math.random() * 6;
        const hue = 340 + Math.random() * 30;

        el.style.left = `${startX}px`;
        el.style.top = `${startY}px`;
        el.style.fontSize = `${size}px`;
        el.style.animationDuration = `${duration}s`;
        el.style.color = `hsl(${hue} 80% 55%)`;

        layer.appendChild(el);
        el.addEventListener("animationend", () => el.remove());
      }

      function startScene(){
        if (started) return;
        started = true;

        reset();
        seedGlow = 1;          // brief glow at base
        animate();             // start canvas loop

        // start flying hearts after intro
        if (!flyTimer){
          flyTimer = setInterval(() => {
            const n = Math.random() < 0.65 ? 1 : 2;
            for(let i=0;i<n;i++) spawnFlyingHeart();
          }, 650);
        }
      }

      // --- Intro: click heart -> drop to ground -> seed glow -> tree ---
      const intro = document.getElementById("intro");
      const introHeart = document.getElementById("introHeart");
      const wrap = document.getElementById("wrapCanvas");

      function runIntro(){
        const r = wrap.getBoundingClientRect();
        const groundY = r.height * 0.86;
        const dropY = groundY - (r.height * 0.5);
        introDropY = dropY;
        intro.style.setProperty("--dropY", `${dropY}px`);

        intro.classList.add("go");

        // after the drop finishes: "plant" the heart and start the scene
        setTimeout(() => {
          intro.classList.add("plant");
          plantActive = true;
          plantStart = performance.now();
          startScene();
        }, 1300);
      }

      introHeart.addEventListener("click", runIntro);
} catch (err) {
      // If anything fails, show it where you can see it
      const sinceEl = document.getElementById("since");
      if (sinceEl) sinceEl.textContent = "Gre≈°ka u skripti (F12 ‚Üí Console)";
      console.error(err);
    }
  });
  </script>
</body>
</html>
